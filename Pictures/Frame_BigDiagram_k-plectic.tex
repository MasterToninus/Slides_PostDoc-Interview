%+------------------------------------------------------------------------+
%| Diagram: Kiddo Diagram - k-plectic case
%| Author: Antonio miti
%+------------------------------------------------------------------------+


\documentclass[beamer]{standalone}
\usepackage{tikz-cd}
\usepackage{mathtools}
\usepackage{amsfonts}
\usetikzlibrary{decorations.pathmorphing}
	%Credit: https://tex.stackexchange.com/questions/99119/beamer-problematic-use-of-visible-and-only-in-combination-with-tikz-to-draw-a
  \tikzset{
    invisible/.style={opacity=0},
    visible on/.style={alt=#1{}{invisible}},
    alt/.code args={<#1>#2#3}{%
      \alt<#1>{\pgfkeysalso{#2}}{\pgfkeysalso{#3}} % \pgfkeysalso doesn't change the path
    },
  }


\begin{document}
	\begin{tikzcd}[column sep= small,row sep=small]
		(M,\omega) 
		\ar[drr,visible on=<2->,rightsquigarrow,"\text{observables}"]
		\ar[rrrr,visible on=<3->,rightsquigarrow,"\text{twisted standard Vinogradov algebroid}"]
		\ar[dddd,visible on=<6->,rightsquigarrow,"\text{gauge transf.}"']
		& & & 
		& |[visible on=<3->]| (TM\oplus\bigwedge^{k-1}T^\ast M,\rho,\langle\cdot,\cdot\rangle,[\cdot,\cdot]_\omega)
		\ar[dl,visible on=<4->,rightsquigarrow]
		\ar[dddd,visible on=<7->,"\text{B-transf.}"]
%
	\\
%
		& \phantom{\big(}
		& |[visible on=<2->]| L_{\infty}(M,\omega)
		\ar[r,visible on=<5->,line width=0.8pt,color=red!60!black]
		\ar[ddr,visible on=<8->,phantom,blue,"\circlearrowright"]
		& |[visible on=<4->]| L_{\infty}\big(\mathbb{T}M,\omega\big)
		\ar[dd,visible on=<7->]
		&
%		 
	\\
%
		&|[visible on=<8->]|\mathfrak{g} \ar[ur,visible on=<8->]\ar[dr,visible on=<8->]& & & 
%
	\\
%
		& &|[visible on=<6->]| L_{\infty}(M,\tilde{\omega})
		\ar[r,visible on=<6->]& 
		|[visible on=<6->]| L_{\infty}\big(\mathbb{T}M,{\tilde{\omega}}\big)
		&
%		
	\\
%	
		|[visible on=<6->]|(M,\tilde{\omega}) 
		\ar[rrrr,visible on=<6->,rightsquigarrow,"\text{ }"]
		\ar[urr,visible on=<6->,rightsquigarrow,"\text{ }"]
		& \phantom{\big(} & & 
		& |[visible on=<6->]| (TM\oplus\bigwedge^{k-1}T^\ast M,\rho,\langle\cdot,\cdot\rangle,[\cdot,\cdot]_{\tilde{\omega}})
		\ar[ul,visible on=<6->,rightsquigarrow]
 	\end{tikzcd}	







\end{document}


		\only<6->{(M,\tilde{\omega}) \ar[rrrr,rightsquigarrow,"\text{}"]
		\ar[urr,rightsquigarrow,"\text{observables}"] }
		& \phantom{\big(} & & 
		& \only<6->{(TM\oplus\bigwedge^{k-1}T^\ast M,\rho,\langle\cdot,\cdot\rangle,[\cdot,\cdot]_{\tilde{\omega}}) \ar[ul,rightsquigarrow] }
 	\end{tikzcd}	